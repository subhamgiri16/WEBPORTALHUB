<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/frontend/public/app.css" />
    <!-- Favicons -->
    <link href="/frontend/images/site_logo.png" rel="icon">


    <!-- <script src="./script/app_1.js" defer></script> -->
    <title>User Form</title>
</head>
<body>

    <!-- module-2 form -->
<form method="POST" id="module2Form" class="form" action="http://127.0.0.1:5500/submit-module2">

    <h3 class="text-center">Please Fill out the form</h3>
    <!-- Progress bar -->
    <div class="progressbar">
        <div class="progress" id="progress"></div>

        <!-- <div class="progress-step progress-step-active" data-title="Module-2" data-step="2"></div> -->
        <div class="progress-step progress-step-active" data-title="Module-2" data-step="2"></div>
    </div>

    <div class="form-step" data-step="2">
        <h1 class="text-center">Module-2</h1>
        <h1 class="text-center schemeName"></h1>
        <div class="input-group">
            <label for="Sl2">SL. (FY2023-24):</label>
            <input type="number" id="Sl2" name="Sl2" required>
        </div>
        <div class="input-group">
            <label for="previousSl2">Sl. (FY 2022-23):</label>
            <input type="number" id="previousSl2" name="previousSl2" required>
        </div>
        <div class="input-group">
            <label for="nitdate">NIT Date (Actual/Likely):</label>
            <input type="date" id="nitdate" name="nitdate" required>
        </div>
        <div class="input-group">
            <label for="tod">TOD (Actual / Likely):</label>
            <input type="date" id="tod" name="tod" required>
        </div>
        <div class="input-group">
            <label for="tc_recomendation_date">TC recommendation Date (Actual / Likely):</label>
            <input type="date" id="tc_recomendation_date" name="tc_recomendation_date" required>
        </div>
        <div class="input-group">
            <label for="stageII_pagdate">Stage-II Plant PAG Date(Actual /Likely):</label>
            <input type="date" id="stageII_pagdate" name="stageII_pagdate" required>
        </div>
        <div class="input-group">
            <label for="stageII_approval">Stage-II Approval (Actual /Likely):</label>
            <input type="date" id="stageII_approval" name="stageII_approval" required>
        </div>
        <div class="input-group">
            <label for="stageII_gross">Stage-II Cost (Gross Rs Cr):</label>
            <input type="number" id="stageII_gross" name="stageII_gross" required>
        </div>
        <div class="input-group">
            <label for="stageII_net">Stage-II Cost (Net Rs Cr):</label>
            <input type="number" id="stageII_net" name="stageII_net" required>
        </div>
        <div>
            <label for="stage1_approval_trend">Stage-I Approval Trend (Actual/ likely):</label>
            <select id="stage1_approval_trend" name="stage1_approval_trend" required>
                <option value="">Select Status</option>
                <option value="status1">Closed</option>
                <option value="status2">Completed</option>
                <option value="status3">Ongoing</option>
                <option value="status1">Under Tendering</option>
                <option value="status2">Under Stage-II approval</option>
                <option value="status3">Under Stage-II PAG</option>
                <option value="status1">Under Stage-I approval</option>
                <option value="status2">Under Stage-I PAG</option>
                <option value="status3">Under Formulation</option>
                <option value="status2">Dropped / Cancelled</option>
                <option value="status3">Capital Repair / Spares</option>
            </select>
        </div>
        <div class="input-group">
            <label for="time_taken_in_issuing_nIT_after_StageI">Time taken in issuing NIT after Stage-I (Actual /
                Likely):</label>
            <input type="number" id="time_taken_in_issuing_nIT_after_StageI"
                name="ttime_taken_in_issuing_nIT_after_StageI" required>
        </div>
        <div class="input-group">
            <label for="nit">NIT (Qtr/FY):</label>
            <input type="number" id="nit" name="nit" required>
        </div>
        <div class="input-group"> 
            <label for="nit_issuing_trend">NIT issuing Trend (Actual/ likely):</label>
            <select id="nit_issuing_trend" name="nit_issuing_trend" required>
                <option value="">Select Status</option>
                <option value="status1">Closed</option>
                <option value="status2">Completed</option>
                <option value="status3">Ongoing</option>
        </div>
        <div>
            <label for="award_trend_nit">Award Trend from NIT (Actual/Likely):</label>
            <select id="award_trend_nit_select" name="award_trend_nit" required>
                <option value="">Select Status</option>
                <option value="status1">Closed</option>
                <option value="status2">Completed</option>
                <option value="status3">Ongoing</option>
                <option value="status1">Under Tendering</option>
                <option value="status2">Under Stage-II approval</option>
                <option value="status3">Under Stage-II PAG</option>
                <option value="status1">Under Stage-I approval</option>
                <option value="status2">Under Stage-I PAG</option>
                <option value="status3">Under Formulation</option>
                <option value="status2">Dropped / Cancelled</option>
                <option value="status3">Capital Repair / Spares</option>
            </select>
        </div>
        <div class="input-group">
            <label for="time_taken_StageIIPAG_after_TC_Recommendation">Time taken in Stage-II PAG after TC
                Recommendation (Actual / Likely):</label>
            <input type="number" id="time_taken_StageIIPAG_after_TC_Recommendation"
                name="time_taken_StageIIPAG_after_TC_Recommendation" required>
        </div>
        <div class="input-group">
            <label for="TC_Recommendation">TC Recommendation (Qtr./FY):</label>
            <input type="number" id="TC_Recommendation" name="TC_Recommendation" required>
        </div>
        <div class="input-group">
            <label for="stageII_plant_pag">Stage-II Plant PAG (Qtr/FY):</label>
            <input type="number" id="stageII_plant_pag" name="stageII_plant_pag" required>
        </div>
        <div>
            <label for="stage2_pag_trend">Stage-II PAG Trend (Actual/ likely):</label>
            <select id="stage2_pag_trend" name="stage2_pag_trend" required>
                <option value="">Select Status</option>
                <option value="status1">Closed</option>
                <option value="status2">Completed</option>
                <option value="status3">Ongoing</option>
                <option value="status1">Under Tendering</option>
                <option value="status2">Under Stage-II approval</option>
                <option value="status3">Under Stage-II PAG</option>
                <option value="status1">Under Stage-I approval</option>
                <option value="status2">Under Stage-I PAG</option>
                <option value="status3">Under Formulation</option>
                <option value="status2">Dropped / Cancelled</option>
                <option value="status3">Capital Repair / Spares</option>
            </select>
        </div>
        <div class="input-group">
            <label for="time_taken_StageII_Approval_from_PAGII">Time taken in Stage-II Approval from PAG-II (Actual
                / Likely):</label>
            <input type="number" id="time_taken_StageII_Approval_from_PAGII"
                name="time_taken_StageII_Approval_from_PAGII" required>
        </div>
        <div class="input-group">
            <label for="stageII_approval_qtr">Stage-II Approval (Qtr/FY):</label>
            <input type="number" id="stageII_approval_qtr" name="stageII_approval_qtr" required>
        </div>
        <div class="input-group">
            <label for="stageII_approval_trend">Stage-II Approval Trend (Actual/ likely):</label>
            <input type="number" id="stageII_approval_trend" name="stageII_approval_trend" required>
        </div>
        <div>
            <label for="award_trend_stage2">Award Trend from Stage-II Approval (Actual/ likely):</label>
            <select id="award_trend_stage2" name="award_trend_stage2" required>
                <option value="">Select Status</option>
                <option value="status1">Closed</option>
                <option value="status2">Completed</option>
                <option value="status3">Ongoing</option>
                <option value="status1">Under Tendering</option>
                <option value="status2">Under Stage-II approval</option>
                <option value="status3">Under Stage-II PAG</option>
                <option value="status1">Under Stage-I approval</option>
                <option value="status2">Under Stage-I PAG</option>
                <option value="status3">Under Formulation</option>
                <option value="status2">Dropped / Cancelled</option>
                <option value="status3">Capital Repair / Spares</option>
            </select>
        </div><br>
        <div>
            <label for="project_delay_trend">Project Delay Trend (Actual / Likely):</label>
            <select id="project_delay_trend" name="project_delay_trend" required>
                <option value="">Select Status</option>
                <option value="status1">Closed</option>
                <option value="status2">Completed</option>
                <option value="status3">Ongoing</option>
                <option value="status1">Under Tendering</option>
                <option value="status2">Under Stage-II approval</option>
                <option value="status3">Under Stage-II PAG</option>
                <option value="status1">Under Stage-I approval</option>
                <option value="status2">Under Stage-I PAG</option>
                <option value="status3">Under Formulation</option>
                <option value="status2">Dropped / Cancelled</option>
                <option value="status3">Capital Repair / Spares</option>
            </select>
        </div><br>
        <div class="btns-group">
            <a href="form.html" class="btn btn-prev"
            style="background-color:lightskyblue; border-radius: 30px; border-color: lightskyblue;">Previous</a>

            <!-- Save Button -->
            <button type="button" onclick="saveData(1)"
                style="background-color:mistyrose; border-radius: 20px; border-color: mistyrose; border: 10% ;">Submit
                Module 2</button>

                <a href="module3.html" class="btn btn-prev"
                style="background-color:lightskyblue; border-radius: 30px; border-color: lightskyblue;">Module-3</a>
                <a href="capex.html" class="btn btn-prev"
                style="background-color:lightskyblue; border-radius: 30px; border-color: lightskyblue;">Capex</a>
        </div>
    </div>
</form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Retrieve selected scheme from localStorage and update scheme name elements
            var selectedScheme = localStorage.getItem("selectedScheme");
            var schemeNameElements = document.getElementsByClassName("schemeName");
            if (selectedScheme) {
                for (var i = 0; i < schemeNameElements.length; i++) {
                    schemeNameElements[i].innerText = "Selected Scheme: " + selectedScheme;
                }
            } else {
                for (var i = 0; i < schemeNameElements.length; i++) {
                    schemeNameElements[i].innerText = "No scheme selected";
                }
            }

            // Retrieve current step from localStorage, default to 0 if not set
            var currentStep = parseInt(localStorage.getItem("currentStep")) || 0;
            showStep(currentStep);

            const progress = document.getElementById('progress');
            const progressSteps = document.querySelectorAll('.progress-step');
            const formSteps = document.querySelectorAll('.form-step');

            progressSteps.forEach((step, index) => {
                step.addEventListener('click', () => {
                    showStep(index);
                });
            });
        });

        function showStep(stepIndex) {
            const progress = document.getElementById('progress');
            const progressSteps = document.querySelectorAll('.progress-step');
            const formSteps = document.querySelectorAll('.form-step');

            // Remove active class from all steps
            progressSteps.forEach(step => step.classList.remove('progress-step-active'));

            // Add active class to clicked step and all previous steps
            for (let i = 0; i <= stepIndex; i++) {
                progressSteps[i].classList.add('progress-step-active');
            }

            // Update progress bar width
            const progressWidth = (stepIndex + 1) / progressSteps.length * 100;
            progress.style.width = progressWidth + '%';

            // Show the corresponding form section
            formSteps.forEach(section => section.classList.remove('form-step-active'));
            formSteps[stepIndex].classList.add('form-step-active');

            // Save current step to localStorage
            localStorage.setItem("currentStep", stepIndex);
        }

        // const form = document.getElementById('multiStepForm');
        // const formSteps = document.querySelectorAll('.form-step');
        // const progress = document.getElementById('progress');
        // const progressSteps = document.querySelectorAll('.progress-step');

        // let formStepIndex = parseInt(localStorage.getItem("currentStep")) || 0;

        // function nextStep() {
        //     if (formStepIndex < formSteps.length - 1) {
        //         formSteps[formStepIndex].classList.remove('form-step-active');
        //         formStepIndex++;
        //         formSteps[formStepIndex].classList.add('form-step-active');
        //         updateProgressBar();
        //     }
        // }

        // function updateProgressBar() {
        //     progressSteps.forEach((progressStep, idx) => {
        //         if (idx <= formStepIndex) {
        //             progressStep.classList.add('progress-step-active');
        //         } else {
        //             progressStep.classList.remove('progress-step-active');
        //         }
        //     });
        //     const progressActive = document.querySelectorAll('.progress-step-active');
        //     progress.style.width = ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + '%';
        // }

        async function saveData(step) {
            let jsonData ;
            if (step == 1) {
                const form = document.getElementById('module1Form');
                const data = new FormData(form);
                jsonData = Object.fromEntries(data.entries());
            }
            else {
                const form = document.getElementById('module2Form');
                const data = new FormData(form);
                jsonData = Object.fromEntries(data.entries());
            }
            // const form = document.getElementById('module1Form');
            // const data = new FormData(form);
            // const jsonData = Object.fromEntries(data.entries());
            const url = step === 1 ? '/submit-module1' : '/submit-module2';

            try {
                const response = await fetch(`http://127.0.0.1:5000${url}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + (localStorage.getItem('accessToken') || '')
                    },
                    body: JSON.stringify(jsonData),
                });
                const result = await response.text();
                alert(result);
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to save data');
            }
        }

        async function submitData() {
            await saveData(2);
            alert('Form submitted successfully');
        }

        // Console.log the access token
        console.log(localStorage.getItem('accessToken'));

    </script>
</body>
</html>
