<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WEBPORTALHUB: Your Online Destination for Dynamic Dashboards and Reports</title>
    <!-- CSS Link -->
    <link rel="stylesheet" href="/frontend/public/styles.css" />

    <!-- Favicons -->
    <link href="/frontend/images/site_logo.png" rel="icon">

    <!-- Box Icon Link for Icons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #3b141c;
            margin: 0;
            padding: 0;
            color: #fff;
        }

        nav {
            background-color: #3b141c;
            padding: 10px;
            text-align: center;
            position: relative;
        }

        .nav_logo {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav_logo img {
            max-height: 70px;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
        }

        nav ul li {
            margin-right: 10px;
        }

        nav ul li a {
            color: #fff;
            font-weight: 700;
            text-decoration: none;
            padding: 10px;
            display: inline-block;
        }

        .container {
            width: 100%;
            margin: 20px auto;
        }

        h1 {
            font-size: 35px;
            font-weight: 600;
            color: chartreuse;
            margin-top: 8px;
            text-align: center;
        }

        .search-container {
            position: relative;
            width: 100%;
            max-width: 400px;
            margin: 0 auto 20px;
        }

        .search-container i {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            color: #f3961c;
        }

        #searchInput {
            width: 100%;
            padding-left: 30px;
            font-size: 16px;
            border: 1px solid #252525;
            border-radius: 5px;
            height: 36px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            color: #fff;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #252525be;
        }

        td[contenteditable="true"] {
            background-color: #fff3e0;
        }

        @media (max-width: 768px) {

            .search-container {
                width: 90%;
            }

            #searchInput {
                width: 100%;
                font-size: 14px;
            }

            table {
                font-size: 14px;
            }

        }

        @media (max-width: 576px) {

            .search-container {
                width: 100%;
            }

            #searchInput {
                height: 32px;
            }

            table,
            th,
            td {
                font-size: 12px;
                padding: 5px;
            }
        }
    </style>
</head>

<body>
    <!-- Header & Navbar Section -->
    <header>
        <nav>
            <div class="nav_logo">
                <a href="index.html">
                    <img src="/frontend/images/logo.png" alt="Logo" />
                </a>
            </div>

            <input type="checkbox" id="click" />
            <label for="click">
                <i class="menu_btn bx bx-menu"></i>
                <i class="close_btn bx bx-x"></i>
            </label>

            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a class="active" href="dashboard.html">Dashboard</a></li>
                <li><a href="forms.html">Forms</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="login.html">Accounts</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>
    <div class="row">
        <div class="column" style="background-color:#aaa;">
            <h2>Sanctioned cost in (Cr.)</h2>
            <button type="button" class="button">a. &gt; 30cr.</button>
            <button type="button" class="btn">b. 2-30cr.</button>
            <button type="button" class="btn">c. &lt;2cr.</button>
            <button type="button" class="btn clear-filter-button">Clear Filter</button>
        </div>
        <div class="column" style="background-color:#bbb;">
            <h2>SCHEME TYPE- APPROVED</h2>
            <button type="button" class="button">a. Corporate.</button>
            <button type="button" class="btn btn-secondary">b. Plant Level.</button>
            <button type="button" class="btn btn-secondary">c. MEP.</button>
            <button type="button" class="btn btn-secondary">d. Cr.</button>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
    </div>


    <div class="row">
        <div class="column" style="background-color:#ccc;">
            <h2>IPM-MM (DO):</h2><br>
            <button type="button" class="btn btn-secondary filter-button">Aditi Sur</button>
            <button type="button" class="btn btn-secondary filter-button">K A Krishna</button>
            <button type="button" class="btn btn-secondary filter-button">R K Vyas</button>
            <button type="button" class="btn btn-secondary filter-button">S Chatterjee</button>
            <button type="button" class="btn btn-secondary filter-button">Blank</button>
            <button type="button" class="btn btn-secondary filter-button">Other</button>
            <button type="button" class="clear-filter-button">Clear Filter</button>

        </div>
        <div class="column" style="background-color:#ddd;">
            <h2>CURRENT STATUS:</h2>
            <div class="scrollable-menu">
                <button type="button" class="btn btn-secondary filter-button">Closed</button>
                <button type="button" class="btn btn-secondary filter-button">Completed</button>
                <button type="button" class="btn btn-secondary filter-button">Ongoing</button>
                <button type="button" class="btn btn-secondary filter-button">Under Tendering</button>
                <button type="button" class="btn btn-secondary filter-button">Under Stage-II approval</button>
                <button type="button" class="btn btn-secondary filter-button">Under Stage-II PAG</button>
                <button type="button" class="btn btn-secondary filter-button">Under Stage-I approval</button>
                <button type="button" class="btn btn-secondary filter-button">Under Stage-I PAG</button>
                <button type="button" class="btn btn-secondary filter-button">Under Formulation</button>
                <button type="button" class="btn btn-secondary filter-button">Dropped / Cancelled</button>
                <button type="button" class="btn btn-secondary filter-button">Capital Repair / Spares</button>
            </div><br>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
    </div>

    <div class="row" style="background-color:#aaa; padding: 20px;">
        <div class="column">
            <h2>Project ID:</h2>
            <div class="scrollable-menu">
                <button type="button" class="btn btn-secondary">B.8.18</button>
                <button type="button" class="btn btn-secondary">B.8.23</button>
                <button type="button" class="btn btn-secondary">B.8.24</button>
                <button type="button" class="btn btn-secondary">B.8.25</button>
                <button type="button" class="btn btn-secondary">B.8.26</button>
                <button type="button" class="btn btn-secondary">B.8.29</button>
                <button type="button" class="btn btn-secondary">B.8.30</button>
                <button type="button" class="btn btn-secondary">B.8.31</button>
            </div><br>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
    </div>

    <h1>Project Details</h1>
    <div class="container">
        <table id="projectTable">
            <thead>
                <tr>
                    <th>Sl1</th>
                    <th>Previous Sl1</th>
                    <th>WBS Element</th>
                    <th>Project ID</th>
                    <th>Scheme Name</th>
                    <th>Sanctioned Cost</th>
                    <th>Anticipated Cost</th>
                    <th>IPM-MM</th>
                    <th>Department</th>
                    <th>Project Manager</th>
                    <th>Current Status</th>
                    <th>Scheme Type</th>
                    <th>Stage1 Approval</th>
                    <th>Stage1 Approval Date</th>
                    <th>Stage1 Cost Gross</th>
                    <th>Stage1 Cost Net</th>
                    <th>Stage1 Approval Time</th>
                    <th>Stage1 PAG QTR</th>
                    <th>Stage1 Approval QTR</th>
                    <th>Stage1 Approval Trend</th>
                    <th>Award Trend NIT</th>
                    <th>Stage2 PAG Trend</th>
                    <th>Award Trend Stage2</th>
                    <th>Project Delay Trend</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic data will be injected here -->
            </tbody>
        </table>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetchFormData();

            function fetchFormData() {
                fetch('http://localhost:5000/api/form_data')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Fetched data:', data);
                        displayFormData(data);
                    })
                    .catch(error => console.error('Error fetching form data:', error));
            }

            function displayFormData(form_data) {
                console.log('Displaying form data:', form_data);
                const tbody = document.querySelector('#projectTable tbody');
                tbody.innerHTML = '';
                form_data.forEach(data => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                        <td>${data.Sl1}</td>
                        <td>${data.previousSl1}</td>
                        <td>${data.wbsElement}</td>
                        <td>${data.projectId}</td>
                        <td>${data.schemeName}</td>
                        <td>${data.sanctionedCost}</td>
                        <td>${data.anticipatedCost}</td>
                        <td>${data.ipmm}</td>
                        <td>${data.dept}</td>
                        <td>${data.proj_mgr}</td>
                        <td>${data.current_status}</td>
                        <td>${data.scheme_type}</td>
                        <td>${data.stage1_approval}</td>
                        <td>${data.stage1_approvaldate}</td>
                        <td>${data.stage1_cost_gross}</td>
                        <td>${data.stage1_cost_net}</td>
                        <td>${data.stage1_approval_time}</td>
                        <td>${data.stage1_pag_qtr}</td>
                        <td>${data.stage1_approval_qtr}</td>
                        <td>${data.stage1_approval_trend}</td>
                        <td>${data.award_trend_nit}</td>
                        <td>${data.stage2_pag_trend}</td>
                        <td>${data.award_trend_stage2}</td>
                        <td>${data.project_delay_trend}</td>
                        <td>
                            <button onclick="updateUser(${data.id})">Update</button>
                            <button onclick="deleteUser(${data.id})">Delete</button>
                        </td>
                    `;
                    tbody.appendChild(tr);
                });
            }

            window.updateRecord = function (sl1) {
                const previousSl1 = document.querySelector(`td[data-id="${sl1}"][data-field="previousSl1"]`).innerText;
                const wbsElement = document.querySelector(`td[data-id="${sl1}"][data-field="wbsElement"]`).innerText;
                const projectId = document.querySelector(`td[data-id="${sl1}"][data-field="projectId"]`).innerText;
                const schemeName = document.querySelector(`td[data-id="${sl1}"][data-field="schemeName"]`).innerText;
                const sanctionedCost = document.querySelector(`td[data-id="${sl1}"][data-field="sanctionedCost"]`).innerText;
                const anticipatedCost = document.querySelector(`td[data-id="${sl1}"][data-field="anticipatedCost"]`).innerText;
                const ipmm = document.querySelector(`td[data-id="${sl1}"][data-field="ipmm"]`).innerText;
                const dept = document.querySelector(`td[data-id="${sl1}"][data-field="dept"]`).innerText;
                const proj_mgr = document.querySelector(`td[data-id="${sl1}"][data-field="proj_mgr"]`).innerText;
                const current_status = document.querySelector(`td[data-id="${sl1}"][data-field="current_status"]`).innerText;
                const scheme_type = document.querySelector(`td[data-id="${sl1}"][data-field="scheme_type"]`).innerText;
                const stage1_approval = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_approval"]`).innerText;
                const stage1_approvaldate = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_approvaldate"]`).innerText;
                const stage1_cost_gross = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_cost_gross"]`).innerText;
                const stage1_cost_net = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_cost_net"]`).innerText;
                const stage1_approval_time = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_approval_time"]`).innerText;
                const stage1_pag_qtr = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_pag_qtr"]`).innerText;
                const stage1_approval_qtr = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_approval_qtr"]`).innerText;
                const stage1_approval_trend = document.querySelector(`td[data-id="${sl1}"][data-field="stage1_approval_trend"]`).innerText;
                const award_trend_nit = document.querySelector(`td[data-id="${sl1}"][data-field="award_trend_nit"]`).innerText;
                const stage2_pag_trend = document.querySelector(`td[data-id="${sl1}"][data-field="stage2_pag_trend"]`).innerText;
                const award_trend_stage2 = document.querySelector(`td[data-id="${sl1}"][data-field="award_trend_stage2"]`).innerText;
                const project_delay_trend = document.querySelector(`td[data-id="${sl1}"][data-field="project_delay_trend"]`).innerText;

                fetch(`http://localhost:5000/api/records/${sl1}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        previousSl1, wbsElement, projectId, schemeName, sanctionedCost,
                        anticipatedCost, ipmm, dept, proj_mgr, current_status, scheme_type,
                        stage1_approval, stage1_approvaldate, stage1_cost_gross, stage1_cost_net,
                        stage1_approval_time, stage1_pag_qtr, stage1_approval_qtr, stage1_approval_trend,
                        award_trend_nit, stage2_pag_trend, award_trend_stage2, project_delay_trend
                    })
                }).then(() => fetchRecords());
            };


            window.deleteRecord = function (sl1) {
                fetch(`http://localhost:5000/api/records/${sl1}`, {
                    method: 'DELETE'
                }).then(() => fetchRecords());
            };

        });
    </script>
</body>

</html>