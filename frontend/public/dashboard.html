<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>WEBPORTALHUB: Your Online Destination for Dynamic Dashboards and Reports</title>
    <!-- CSS Link -->
    <link rel="stylesheet" href="/frontend/public/styles.css" />

    <!-- Favicons -->
    <link href="/frontend/images/site_logo.png" rel="icon">

    <!-- Box Icon Link for Icons -->
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #3b141c;
            margin: 0;
            padding: 0;
            color: #fff;
        }

        nav {
            background-color: #3b141c;
            padding: 10px;
            text-align: center;
            position: relative;
        }

        .nav_logo {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .nav_logo img {
            max-height: 70px;
        }

        nav ul {
            list-style: none;
            padding: 0;
            margin: 0;
            display: flex;
            justify-content: center;
        }

        nav ul li {
            margin-right: 10px;
        }

        nav ul li a {
            color: #fff;
            font-weight: 700;
            text-decoration: none;
            padding: 10px;
            display: inline-block;
        }

        .container {
            width: 100%;
            margin: 20px auto;
        }

        h1 {
            font-size: 35px;
            font-weight: 600;
            color: chartreuse;
            margin-top: 8px;
            text-align: center;
        }


        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            color: #fff;
        }

        table,
        th,
        td {
            border: 1px solid #ddd;
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #4d4b4bbe;
        }

        td[contenteditable="true"] {
            background-color: #fff3e0;
        }

        @media (max-width: 768px) {

            .search-container {
                width: 90%;
            }

            #searchInput {
                width: 100%;
                font-size: 14px;
            }

            table {
                font-size: 14px;
            }

        }

        @media (max-width: 576px) {

            .search-container {
                width: 100%;
            }

            #searchInput {
                height: 32px;
            }

            table,
            th,
            td {
                font-size: 12px;
                padding: 5px;
            }
        }
    </style>
</head>

<body>
    <!-- Header & Navbar Section -->
    <header>
        <nav>
            <div class="nav_logo">
                <a href="index.html">
                    <img src="/frontend/images/logo.png" alt="Logo" />
                </a>
            </div>

            <input type="checkbox" id="click" />
            <label for="click">
                <i class="menu_btn bx bx-menu"></i>
                <i class="close_btn bx bx-x"></i>
            </label>

            <ul>
                <li><a href="index.html">Home</a></li>
                <li><a class="active" href="dashboard.html">Dashboard</a></li>
                <li><a href="forms.html">Forms</a></li>
                <li><a href="reports.html">Reports</a></li>
                <li><a href="login.html">Accounts</a></li>
                <li><a href="contact.html">Contact</a></li>
            </ul>
        </nav>
    </header>
    <div class="row">
        <div class="column" style="background-color:#aaa;">
            <h2>Sanctioned cost in (Cr.)</h2>
            <button type="button" class="filter-button" data-filter="sanctionedCost" data-value=">30">a. &gt;
                30cr.</button>
            <button type="button" class="filter-button" data-filter="sanctionedCost" data-value="2-30">b.
                2-30cr.</button>
            <button type="button" class="filter-button" data-filter="sanctionedCost" data-value="<2">c.
                &lt;2cr.</button>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
        <div class="column" style="background-color:#bbb;">
            <h2>SCHEME TYPE- APPROVED</h2>
            <button type="button" class="filter-button" data-filter="schemeType" data-value="Corporate">a.
                Corporate.</button>
            <button type="button" class="filter-button" data-filter="schemeType" data-value="Plant Level">b. Plant
                Level.</button>
            <button type="button" class="filter-button" data-filter="schemeType" data-value="MEP">c. MEP.</button>
            <button type="button" class="filter-button" data-filter="schemeType" data-value="Cr">d. Cr.</button>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
    </div>


    <div class="row">
        <div class="column" style="background-color:#ccc;">
            <h2>IPM-MM (DO):</h2><br>
            <button type="button" class="filter-button" data-filter="ipmm" data-value="Aditi Sur">Aditi Sur</button>
            <button type="button" class="filter-button" data-filter="ipmm" data-value="K A Krishna">K A Krishna</button>
            <button type="button" class="filter-button" data-filter="ipmm" data-value="R K Vyas">R K Vyas</button>
            <button type="button" class="filter-button" data-filter="ipmm" data-value="S Chatterjee">S
                Chatterjee</button>
            <button type="button" class="filter-button" data-filter="ipmm" data-value="Blank">Blank</button>
            <button type="button" class="filter-button" data-filter="ipmm" data-value="Other">Other</button>
            <button type="button" class="clear-filter-button">Clear Filter</button>

        </div>
        <div class="column" style="background-color:#ddd;">
            <h2>CURRENT STATUS:</h2>
            <div class="scrollable-menu">
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Closed">Closed</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Completed">Completed</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Ongoing">Ongoing</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Under Tendering">Under Tendering</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Under Stage-II approval">Under Stage-II approval</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Under Stage-II PAG">Under Stage-II PAG</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Under Stage-I approval">Under Stage-I approval</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Under Stage-I PAG">Under Stage-I PAG</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Under Formulation">Under Formulation</button>
                <button type="button" class="filter-button" data-filter="currentStatus"
                    data-value="Dropped / Cancelled">Dropped / Cancelled</button>
                <button type="button" class="filter-button" data-filter="currentStatus" data-value="Not Started">Not
                    Started</button>
            </div>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
    </div>

    <div class="row" style="background-color:#aaa; padding: 20px;">
        <div class="column">
            <h2>Project ID:</h2>
            <div class="scrollable-menu">
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.18">B.8.18</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.23">B.8.23</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.24">B.8.24</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.25">B.8.25</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.26">B.8.26</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.29">B.8.29</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.30">B.8.30</button>
                <button type="button" class="filter-button" data-filter="projectId" data-value="B.8.31">B.8.31</button>
            </div><br>
            <button type="button" class="clear-filter-button">Clear Filter</button>
        </div>
    </div>


    <h1>List of All Data</h1>
    <div class="container">
        <table id="projectTable">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Sl1</th>
                    <th>Previous Sl1</th>
                    <th>WBS Element</th>
                    <th>Project ID</th>
                    <th>Scheme Name</th>
                    <th>Sanctioned Cost</th>
                    <th>Anticipated Cost</th>
                    <th>IPM-MM</th>
                    <th>Department</th>
                    <th>Project Manager</th>
                    <th>Current Status</th>
                    <th>Scheme Type</th>
                    <th>Stage1 Approval</th>
                    <th>Stage1 Approval Date</th>
                    <th>Stage1 Cost Gross</th>
                    <th>Stage1 Cost Net</th>
                    <th>Stage1 Approval Time</th>
                    <th>Stage1 PAG QTR</th>
                    <th>Stage1 Approval QTR</th>
                    <th>Stage1 Approval Trend</th>
                    <th>Award Trend NIT</th>
                    <th>Stage2 PAG Trend</th>
                    <th>Award Trend Stage2</th>
                    <th>Project Delay Trend</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic data will be injected here -->
            </tbody>
        </table>
    </div>



    <div class="container">
        <table id="projectTable1">
            <thead>
                <tr>
                    <th>Sl2</th>
                    <th>Previous Sl2</th>
                    <th>NIT Date</th>
                    <th>TOD</th>
                    <th>TC Recommendation Date</th>
                    <th>Stage II PAG Date</th>
                    <th>Stage II Approval</th>
                    <th>Stage II Gross</th>
                    <th>Stage II Net</th>
                    <th>Stage I Approval Trend</th>
                    <th>Time Taken in Issuing NIT after Stage I</th>
                    <th>NIT</th>
                    <th>Award Trend NIT</th>
                    <th>Time Taken Stage II PAG after TC Recommendation</th>
                    <th>TC Recommendation</th>
                    <th>Stage II Plant PAG</th>
                    <th>Stage II PAG Trend</th>
                    <th>Time Taken Stage II Approval from PAG II</th>
                    <th>Stage II Approval QTR</th>
                    <th>Stage II Approval Trend</th>
                    <th>Award Trend Stage 2</th>
                    <th>Project Delay Trend</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic data will be injected here -->
            </tbody>
        </table>
    </div><br><br>

    <div class="container">
        <table id="projectTable2">
            <thead>
                <tr>
                    <th>Sl3</th>
                    <th>previousSl3</th>
                    <th>award_date</th>
                    <th>order_cost</th>
                    <th>order_cost_net</th>
                    <th>party_name</th>
                    <th>email</th>
                    <th>contact_no</th>
                    <th>pan_no</th>
                    <th>contract_date</th>
                    <th>completion_period</th>
                    <th>completion_date</th>
                    <th>actual_completion_date</th>
                    <th>delay_reason</th>
                    <th>action_taken</th>
                    <th>status_scheme</th>
                    <th>stage1_approval_trend</th>
                    <th>award_nit</th>
                    <th>award_date_qtr</th>
                    <th>award_trend_nit</th>
                    <th>stage2_pag_trend</th>
                    <th>time_taken_stage_approval</th>
                    <th>award_trend_stage2</th>
                    <th>eff_contractdate</th>
                    <th>schedule_completion</th>
                    <th>completion_qtr</th>
                    <th>projectdelay</th>
                    <th>project_delay_trend</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                <!-- Dynamic data will be injected here -->
            </tbody>
        </table>
    </div><br><br>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const projectTable = document.getElementById("projectTable").getElementsByTagName("tbody")[0];


            let projectsData = [];


            fetch("/api/projects")
                .then(response => response.json())
                .then(data => {
                    projectsData = data;
                    displayProjects(projectsData);
                })
                .catch(error => console.error("Error fetching project data:", error));

            function displayProjects(projects) {
                projectTable.innerHTML = "";
                projects.forEach(project => {
                    const row = projectTable.insertRow();
                    Object.values(project).forEach(value => {
                        const cell = row.insertCell();
                        cell.textContent = value;
                    });
                });
            }

            function filterProjects() {
                const searchTerm = searchInput.value.toLowerCase();
                const filteredProjects = projectsData.filter(project =>
                    Object.values(project).some(value =>
                        String(value).toLowerCase().includes(searchTerm)
                    )
                );
                displayProjects(filteredProjects);
            }

            searchInput.addEventListener("input", filterProjects);

            // Filter buttons
            const filterButtons = document.querySelectorAll('.filter-button');
            const clearFilterButtons = document.querySelectorAll('.clear-filter-button');
            let filters = {};

            filterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const filterType = button.getAttribute('data-filter');
                    const filterValue = button.getAttribute('data-value');
                    filters[filterType] = filterValue;
                    applyFilters();
                });
            });

            clearFilterButtons.forEach(button => {
                button.addEventListener('click', () => {
                    filters = {};
                    displayProjects(projectsData);
                });
            });

            function applyFilters() {
                let filteredProjects = projectsData;

                if (filters.sanctionedCost) {
                    if (filters.sanctionedCost === '>30') {
                        filteredProjects = filteredProjects.filter(project => parseFloat(project.SANCTIONED_COST_CR) > 30);
                    } else if (filters.sanctionedCost === '2-30') {
                        filteredProjects = filteredProjects.filter(project => parseFloat(project.SANCTIONED_COST_CR) >= 2 && parseFloat(project.SANCTIONED_COST_CR) <= 30);
                    } else if (filters.sanctionedCost === '<2') {
                        filteredProjects = filteredProjects.filter(project => parseFloat(project.SANCTIONED_COST_CR) < 2);
                    }
                }

                if (filters.schemeType) {
                    filteredProjects = filteredProjects.filter(project => project.SCHEME_TYPE === filters.schemeType);
                }

                if (filters.ipmm) {
                    filteredProjects = filteredProjects.filter(project => project.IPMM === filters.ipmm);
                }

                if (filters.currentStatus) {
                    filteredProjects = filteredProjects.filter(project => project.CURRENT_STATUS === filters.currentStatus);
                }

                if (filters.projectId) {
                    filteredProjects = filteredProjects.filter(project => project.SAP_CODE === filters.projectId);
                }

                displayProjects(filteredProjects);
            }
        });

        document.addEventListener("DOMContentLoaded", function () {
            fetchFormData();

            function fetchFormData() {
                fetch('http://localhost:5000/api/form_data')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Fetched data:', data);
                        displayFormData(data);
                    })
                    .catch(error => console.error('Error fetching form data:', error));
            }

            function displayFormData(form_data) {
                console.log('Displaying form data:', form_data);
                const tbody = document.querySelector('#projectTable tbody');
                tbody.innerHTML = '';
                form_data.forEach(data => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${data.id}</td>
                <td>${data.Sl1}</td>
                <td>${data.previousSl1}</td>
                <td>${data.wbsElement}</td>
                <td>${data.projectId}</td>
                <td>${data.schemeName}</td>
                <td>${data.sanctionedCost}</td>
                <td>${data.anticipatedCost}</td>
                <td>${data.ipmm}</td>
                <td>${data.dept}</td>
                <td>${data.proj_mgr}</td>
                <td>${data.current_status}</td>
                <td>${data.scheme_type}</td>
                <td>${data.stage1_approval}</td>
                <td>${data.stage1_approvaldate}</td>
                <td>${data.stage1_cost_gross}</td>
                <td>${data.stage1_cost_net}</td>
                <td>${data.stage1_approval_time}</td>
                <td>${data.stage1_pag_qtr}</td>
                <td>${data.stage1_approval_qtr}</td>
                <td>${data.stage1_approval_trend}</td>
                <td>${data.award_trend_nit}</td>
                <td>${data.stage2_pag_trend}</td>
                <td>${data.award_trend_stage2}</td>
                <td>${data.project_delay_trend}</td>
                <td>
                    <button onclick="updateRecord(${data.id})" style="background-color: #007bff;">Update</button>
                    <button onclick="deleteRecord(${data.id})" style="background-color: red;">Delete</button>
                </td>
            `;
                    tbody.appendChild(tr);
                });
            }

            window.updateRecord = function (id) {
                // Retrieve values from table cells
                const Sl1 = document.querySelector(`td[data-id="${id}"][data-field="Sl1"]`).innerText;
                const previousSl1 = document.querySelector(`td[data-id="${id}"][data-field="previousSl1"]`).innerText;
                const wbsElement = document.querySelector(`td[data-id="${id}"][data-field="wbsElement"]`).innerText;
                const projectId = document.querySelector(`td[data-id="${id}"][data-field="projectId"]`).innerText;
                const schemeName = document.querySelector(`td[data-id="${id}"][data-field="schemeName"]`).innerText;
                const sanctionedCost = document.querySelector(`td[data-id="${id}"][data-field="sanctionedCost"]`).innerText;
                const anticipatedCost = document.querySelector(`td[data-id="${id}"][data-field="anticipatedCost"]`).innerText;
                const ipmm = document.querySelector(`td[data-id="${id}"][data-field="ipmm"]`).innerText;
                const dept = document.querySelector(`td[data-id="${id}"][data-field="dept"]`).innerText;
                const proj_mgr = document.querySelector(`td[data-id="${id}"][data-field="proj_mgr"]`).innerText;
                const current_status = document.querySelector(`td[data-id="${id}"][data-field="current_status"]`).innerText;
                const scheme_type = document.querySelector(`td[data-id="${id}"][data-field="scheme_type"]`).innerText;
                const stage1_approval = document.querySelector(`td[data-id="${id}"][data-field="stage1_approval"]`).innerText;
                const stage1_approvaldate = document.querySelector(`td[data-id="${id}"][data-field="stage1_approvaldate"]`).innerText;
                const stage1_cost_gross = document.querySelector(`td[data-id="${id}"][data-field="stage1_cost_gross"]`).innerText;
                const stage1_cost_net = document.querySelector(`td[data-id="${id}"][data-field="stage1_cost_net"]`).innerText;
                const stage1_approval_time = document.querySelector(`td[data-id="${id}"][data-field="stage1_approval_time"]`).innerText;
                const stage1_pag_qtr = document.querySelector(`td[data-id="${id}"][data-field="stage1_pag_qtr"]`).innerText;
                const stage1_approval_qtr = document.querySelector(`td[data-id="${id}"][data-field="stage1_approval_qtr"]`).innerText;
                const stage1_approval_trend = document.querySelector(`td[data-id="${id}"][data-field="stage1_approval_trend"]`).innerText;
                const award_trend_nit = document.querySelector(`td[data-id="${id}"][data-field="award_trend_nit"]`).innerText;
                const stage2_pag_trend = document.querySelector(`td[data-id="${id}"][data-field="stage2_pag_trend"]`).innerText;
                const award_trend_stage2 = document.querySelector(`td[data-id="${id}"][data-field="award_trend_stage2"]`).innerText;
                const project_delay_trend = document.querySelector(`td[data-id="${id}"][data-field="project_delay_trend"]`).innerText;

                // Make PUT request to update record
                fetch(`http://localhost:5000/api/records/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        Sl1, previousSl1, wbsElement, projectId, schemeName, sanctionedCost,
                        anticipatedCost, ipmm, dept, proj_mgr, current_status, scheme_type,
                        stage1_approval, stage1_approvaldate, stage1_cost_gross, stage1_cost_net,
                        stage1_approval_time, stage1_pag_qtr, stage1_approval_qtr, stage1_approval_trend,
                        award_trend_nit, stage2_pag_trend, award_trend_stage2, project_delay_trend
                    })
                }).then(() => fetchFormData());  // Refresh data after update
            };

            window.deleteRecord = function (id) {
                // Make DELETE request to delete record
                fetch(`http://localhost:5000/api/records/${id}`, {
                    method: 'DELETE'
                }).then(() => fetchFormData());  // Refresh data after delete
            };

        });


        document.addEventListener("DOMContentLoaded", function () {
            fetchFormData();

            function fetchFormData() {
                fetch('http://localhost:5000/api/module2')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Fetched data:', data);
                        displayFormData(data);
                    })
                    .catch(error => console.error('Error fetching form data:', error));
            }

            function displayFormData(form_data) {
                console.log('Displaying form data:', form_data);
                const tbody = document.querySelector('#projectTable1 tbody');
                tbody.innerHTML = '';
                form_data.forEach(data => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${data.Sl2}</td>
                <td>${data.previousSl2}</td>
                <td>${data.nitdate}</td>
                <td>${data.tod}</td>
                <td>${data.tc_recomendation_date}</td>
                <td>${data.stageII_pagdate}</td>
                <td>${data.stageII_approval}</td>
                <td>${data.stageII_gross}</td>
                <td>${data.stageII_net}</td>
                <td>${data.stage1_approval_trend}</td>
                <td>${data.time_taken_in_issuing_nIT_after_StageI}</td>
                <td>${data.nit}</td>
                <td>${data.award_trend_nit}</td>
                <td>${data.time_taken_StageIIPAG_after_TC_Recommendation}</td>
                <td>${data.TC_Recommendation}</td>
                <td>${data.stageII_plant_pag}</td>
                <td>${data.stage2_pag_trend}</td>
                <td>${data.time_taken_StageII_Approval_from_PAGII}</td>
                <td>${data.stageII_approval_qtr}</td>
                <td>${data.stageII_approval_trend}</td>
                <td>${data.award_trend_stage2}</td>
                <td>${data.project_delay_trend}</td>
                <td>
                    <button onclick="updateUser(${data.Sl2})" style="background-color: #007bff;">Update</button>
                    <button onclick="deleteUser(${data.Sl2})" style="background-color: red;">Delete</button>
                </td>
            `;
                    tbody.appendChild(tr);
                });
            }

            window.updateRecord = function (Sl2) {
                // Extract data from table cells
                const previousSl2 = document.querySelector(`td[data-id="${Sl2}"][data-field="previousSl2"]`).innerText;
                const nitdate = document.querySelector(`td[data-id="${Sl2}"][data-field="nitdate"]`).innerText;
                const tod = document.querySelector(`td[data-id="${Sl2}"][data-field="tod"]`).innerText;
                const tc_recomendation_date = document.querySelector(`td[data-id="${Sl2}"][data-field="tc_recomendation_date"]`).innerText;
                const stageII_pagdate = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_pagdate"]`).innerText;
                const stageII_approval = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_approval"]`).innerText;
                const stageII_gross = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_gross"]`).innerText;
                const stageII_net = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_net"]`).innerText;
                const stage1_approval_trend = document.querySelector(`td[data-id="${Sl2}"][data-field="stage1_approval_trend"]`).innerText;
                const time_taken_in_issuing_nIT_after_StageI = document.querySelector(`td[data-id="${Sl2}"][data-field="time_taken_in_issuing_nIT_after_StageI"]`).innerText;
                const nit = document.querySelector(`td[data-id="${Sl2}"][data-field="nit"]`).innerText;
                const award_trend_nit = document.querySelector(`td[data-id="${Sl2}"][data-field="award_trend_nit"]`).innerText;
                const time_taken_StageIIPAG_after_TC_Recommendation = document.querySelector(`td[data-id="${Sl2}"][data-field="time_taken_StageIIPAG_after_TC_Recommendation"]`).innerText;
                const TC_Recommendation = document.querySelector(`td[data-id="${Sl2}"][data-field="TC_Recommendation"]`).innerText;
                const stageII_plant_pag = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_plant_pag"]`).innerText;
                const stage2_pag_trend = document.querySelector(`td[data-id="${Sl2}"][data-field="stage2_pag_trend"]`).innerText;
                const time_taken_StageII_Approval_from_PAGII = document.querySelector(`td[data-id="${Sl2}"][data-field="time_taken_StageII_Approval_from_PAGII"]`).innerText;
                const stageII_approval_qtr = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_approval_qtr"]`).innerText;
                const stageII_approval_trend = document.querySelector(`td[data-id="${Sl2}"][data-field="stageII_approval_trend"]`).innerText;
                const award_trend_stage2 = document.querySelector(`td[data-id="${Sl2}"][data-field="award_trend_stage2"]`).innerText;
                const project_delay_trend = document.querySelector(`td[data-id="${Sl2}"][data-field="project_delay_trend"]`).innerText;

                // Construct the update request
                fetch(`http://localhost:5000/api/records/${Sl2}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        previousSl2, nitdate, tod, tc_recomendation_date, stageII_pagdate,
                        stageII_approval, stageII_gross, stageII_net, stage1_approval_trend,
                        time_taken_in_issuing_nIT_after_StageI, nit, award_trend_nit,
                        time_taken_StageIIPAG_after_TC_Recommendation, TC_Recommendation,
                        stageII_plant_pag, stage2_pag_trend, time_taken_StageII_Approval_from_PAGII,
                        stageII_approval_qtr, stageII_approval_trend, award_trend_stage2,
                        project_delay_trend
                    })
                })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Failed to update record');
                        }
                        console.log(`Record with Sl2 ${Sl2} updated successfully`);
                        fetchRecords(); // Refresh table data
                    })
                    .catch(error => {
                        console.error('Error updating record:', error);
                        // Handle error
                    });
            };

            window.deleteRecord = function (Sl2) {
                fetch(`http://localhost:5000/api/records/${Sl2}`, {
                    method: 'DELETE'
                }).then(() => fetchRecords());
            };

        });

        document.addEventListener("DOMContentLoaded", function () {
            fetchFormData();

            function fetchFormData() {
                fetch('http://localhost:5000/api/module3')
                    .then(response => response.json())
                    .then(data => {
                        console.log('Fetched data:', data);
                        displayFormData(data);
                    })
                    .catch(error => console.error('Error fetching form data:', error));
            }

            function displayFormData(form_data) {
                console.log('Displaying form data:', form_data);
                const tbody = document.querySelector('#projectTable tbody');
                tbody.innerHTML = '';
                form_data.forEach(data => {
                    const tr = document.createElement('tr');
                    tr.innerHTML = `
                <td>${data.Sl3}</td>
                <td>${data.previousSl3}</td>
                <td>${data.award_date}</td>
                <td>${data.order_cost}</td>
                <td>${data.order_cost_net}</td>
                <td>${data.party_name}</td>
                <td>${data.email}</td>
                <td>${data.contact_no}</td>
                <td>${data.pan_no}</td>
                <td>${data.contract_date}</td>
                <td>${data.completion_period}</td>
                <td>${data.completion_date}</td>
                <td>${data.actual_completion_date}</td>
                <td>${data.delay_reason}</td>
                <td>${data.action_taken}</td>
                <td>${data.status_scheme}</td>
                <td>${data.stage1_approval_trend}</td>
                <td>${data.award_nit}</td>
                <td>${data.award_date_qtr}</td>
                <td>${data.award_trend_nit}</td>
                <td>${data.stage2_pag_trend}</td>
                <td>${data.time_taken_stage_approval}</td>
                <td>${data.award_trend_stage2}</td>
                <td>${data.eff_contractdate}</td>
                <td>${data.schedule_completion}</td>
                <td>${data.completion_qtr}</td>
                <td>${data.projectdelay}</td>
                <td>${data.project_delay_trend}</td>
                <td>
                    <button onclick="updateUser(${data.Sl3})" style="background-color: #007bff;">Update</button>
                    <button onclick="deleteUser(${data.Sl3})" style="background-color: red;">Delete</button>
                </td>
            `;
                    tbody.appendChild(tr);
                });
            }
        });


    </script>
</body>

</html>