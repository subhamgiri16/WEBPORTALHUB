<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/frontend/public/app.css" />
    <!-- Favicons -->
    <link href="/frontend/images/site_logo.png" rel="icon">


    <!-- <script src="./script/app_1.js" defer></script> -->
    <title>User Form</title>
</head>

<body>
    <form method="POST" id="module1Form" class="form" action="http://127.0.0.1:5500/submit-module_1">

        <h3 class="text-center">Please Fill out the form</h3>
        <!-- Progress bar -->
        <div class="progressbar">
            <div class="progress" id="progress"></div>

            <div class="progress-step progress-step-active" data-title="Module-1" data-step="1"></div>
        </div>


        <!-- module-1 form -->
        <div class="form-step form-step-active" data-step="1">
            <h1 class="text-center">Module-1</h1>
            <h1 class="text-center schemeName"></h1>
            <div class="input-group">
                <label for="Sl1">SL. (FY2023-24):</label>
                <input type="number" id="Sl1" name="Sl1" required>
            </div>
            <div class="input-group">
                <label for="previousSl1">Sl. (FY 2022-23):</label>
                <input type="number" id="previousSl1" name="previousSl1" required>
            </div>
            <div>
                <label for="wbsElement">WBS Element IPM-F&A:</label>
                <input type="text" id="wbsElement" name="wbsElement" required>
            </div><br>
            <div>
                <label for="projectId">PROJECT ID:</label>
                <input type="text" id="projectId" name="projectId" required>
            </div><br>

            <div>
                <label for="schemeName">Scheme Name:</label>
                <input type="text" id="schemeName" name="schemeName" required>
            </div><br>
            <div>
                <label for="sanctionedCost">Sanctioned cost (INR / Crs):</label>
                <input type="number" id="sanctionedCost" name="sanctionedCost" required>
            </div> <br>
            <div>
                <label for="anticipatedCost">Anticipated cost (INR / Crs):</label>
                <input type="number" id="anticipatedCost" name="anticipatedCost" required>
            </div><br>
            <div>
                <label for="ipmm">IPM-MM (DO):</label>
                <select id="ipmm" name="ipmm" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div><br>
            <div>
                <label for="dept">Dept:</label>
                <select id="dept" name="dept" required>
                    <option value="">Select Department</option>
                    <option value="dept1">Dept 1</option>
                    <option value="dept2">Dept 2</option>
                </select>
            </div> <br>
            <div>
                <label for="proj_mgr">PROJ MGR:</label>
                <select id="proj_mgr" name="proj_mgr" required>
                    <option value="">Select Manager</option>
                    <option value="manager1">Gopal Prasad</option>
                    <option value="manager2">C S Pant</option>
                    <option value="manager3">P K Sinha</option>
                    <option value="manager4">Sanjay Kar</option>
                    <option value="manager5">Suresh Sarkar</option>
                    <option value="manager6">Medical Org</option>
                    <option value="manager7">Misc</option>
                </select>
            </div> <br>
            <div>
                <label for="current_status">CURRENT STATUS:</label>
                <select id="current_status" name="current_status" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div> <br>
            <div>
                <label for="scheme_type">SCHEME TYPE:</label>
                <select id="scheme_type" name="scheme_type" required>
                    <option value="">Select Scheme</option>
                    <option value="scheme1">Corporate</option>
                    <option value="scheme2">IPU</option>
                    <option value="scheme3">MEP</option>
                    <option value="scheme4">CR</option>
                </select>
            </div><br>
            <div>
                <label for="stage1_approval">Stage-I Plant PAG Date (Actual/Likely):</label>
                <input type="date" id="stage1_approval" name="stage1_approval" required placeholder="Select date">
            </div><br>
            <div>
                <label for="stage1_approvaldate">Stage-I Approval Date (Actual/Likely):</label>
                <input type="date" id="stage1_approvaldate" name="stage1_approvaldate" required
                    placeholder="Select date">
            </div><br>
            <div>
                <label for="stage1_cost_gross">Stage-I Cost (Gross Rs Cr):</label>
                <input type="number" id="stage1_cost_gross" name="stage1_cost_gross">
            </div> <br>
            <div>
                <label for="stage1_cost_net">Stage-I Cost (Net Rs Cr):</label>
                <input type="number" id="stage1_cost_net" name="stage1_cost_net">
            </div><br>
            <div>
                <label for="stage1_approval_time">Time taken in Stage-I Approval from PAG-I (Actual / Likely):</label>
                <input type="number" id="stage1_approval_time" name="stage1_approval_time">
            </div> <br>
            <div>
                <label for="stage1_pag_qtr">Stage-I PAG (Qtr/FY):</label>
                <input type="number" id="stage1_pag_qtr" name="stage1_pag_qtr">
            </div><br>

            <div>
                <label for="stage1_approval_qtr">Stage-I Approval (Qtr/FY):</label>
                <input type="number" id="stage1_approval_qtr" name="stage1_approval_qtr">
            </div><br>

            <div>
                <label for="stage1_approval_trend">Stage-I Approval Trend (Actual/ likely):</label>
                <select id="stage1_approval_trend" name="stage1_approval_trend" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div><br>

            <div>
                <label for="award_trend_nit">Award Trend from NIT (Actual/Likely):</label>
                <select id="award_trend_nit" name="award_trend_nit" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div><br>

            <div>
                <label for="stage2_pag_trend">Stage-II PAG Trend (Actual/ likely):</label>
                <select id="stage2_pag_trend" name="stage2_pag_trend" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div><br>

            <div>
                <label for="award_trend_stage2">Award Trend from Stage-II Approval (Actual/ likely):</label>
                <select id="award_trend_stage2" name="award_trend_stage2" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div><br>

            <div>
                <label for="project_delay_trend">Project Delay Trend (Actual / Likely):</label>
                <select id="project_delay_trend" name="project_delay_trend" required>
                    <option value="">Select Status</option>
                    <option value="status1">Closed</option>
                    <option value="status2">Completed</option>
                    <option value="status3">Ongoing</option>
                    <option value="status1">Under Tendering</option>
                    <option value="status2">Under Stage-II approval</option>
                    <option value="status3">Under Stage-II PAG</option>
                    <option value="status1">Under Stage-I approval</option>
                    <option value="status2">Under Stage-I PAG</option>
                    <option value="status3">Under Formulation</option>
                    <option value="status2">Dropped / Cancelled</option>
                    <option value="status3">Capital Repair / Spares</option>
                </select>
            </div><br>
            <div class="btns-group">
                <!-- Save Button -->
                <button type="button" onclick="saveData(1)"
                    style="background-color:mistyrose; border-radius: 20px; border-color: mistyrose; border: 10% ;">Submit
                    Module 1</button>

                <a href="module2.html" class="btn btn-prev"
                    style="background-color:lightskyblue; border-radius: 30px; border-color: lightskyblue;">Module-2</a>
                <a href="module3.html" class="btn btn-prev"
                    style="background-color:lightskyblue; border-radius: 30px; border-color: lightskyblue;">Module-3</a>
                <a href="capex.html" class="btn btn-prev"
                    style="background-color:lightskyblue; border-radius: 30px; border-color: lightskyblue;">Capex</a>
            </div>
        </div>
    </form>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Retrieve selected scheme from localStorage and update scheme name elements
            var selectedScheme = localStorage.getItem("selectedScheme");
            var schemeNameElements = document.getElementsByClassName("schemeName");
            if (selectedScheme) {
                for (var i = 0; i < schemeNameElements.length; i++) {
                    schemeNameElements[i].innerText = "Selected Scheme: " + selectedScheme;
                }
            } else {
                for (var i = 0; i < schemeNameElements.length; i++) {
                    schemeNameElements[i].innerText = "No scheme selected";
                }
            }

            // Retrieve current step from localStorage, default to 0 if not set
            var currentStep = parseInt(localStorage.getItem("currentStep")) || 0;
            showStep(currentStep);

            const progress = document.getElementById('progress');
            const progressSteps = document.querySelectorAll('.progress-step');
            const formSteps = document.querySelectorAll('.form-step');

            progressSteps.forEach((step, index) => {
                step.addEventListener('click', () => {
                    showStep(index);
                });
            });
        });

        function showStep(stepIndex) {
            const progress = document.getElementById('progress');
            const progressSteps = document.querySelectorAll('.progress-step');
            const formSteps = document.querySelectorAll('.form-step');

            // Remove active class from all steps
            progressSteps.forEach(step => step.classList.remove('progress-step-active'));

            // Add active class to clicked step and all previous steps
            for (let i = 0; i <= stepIndex; i++) {
                progressSteps[i].classList.add('progress-step-active');
            }

            // Update progress bar width
            const progressWidth = (stepIndex + 1) / progressSteps.length * 100;
            progress.style.width = progressWidth + '%';

            // Show the corresponding form section
            formSteps.forEach(section => section.classList.remove('form-step-active'));
            formSteps[stepIndex].classList.add('form-step-active');

            // Save current step to localStorage
            localStorage.setItem("currentStep", stepIndex);
        }

        // const form = document.getElementById('multiStepForm');
        // const formSteps = document.querySelectorAll('.form-step');
        // const progress = document.getElementById('progress');
        // const progressSteps = document.querySelectorAll('.progress-step');

        // let formStepIndex = parseInt(localStorage.getItem("currentStep")) || 0;

        // function nextStep() {
        //     if (formStepIndex < formSteps.length - 1) {
        //         formSteps[formStepIndex].classList.remove('form-step-active');
        //         formStepIndex++;
        //         formSteps[formStepIndex].classList.add('form-step-active');
        //         updateProgressBar();
        //     }
        // }

        // function updateProgressBar() {
        //     progressSteps.forEach((progressStep, idx) => {
        //         if (idx <= formStepIndex) {
        //             progressStep.classList.add('progress-step-active');
        //         } else {
        //             progressStep.classList.remove('progress-step-active');
        //         }
        //     });
        //     const progressActive = document.querySelectorAll('.progress-step-active');
        //     progress.style.width = ((progressActive.length - 1) / (progressSteps.length - 1)) * 100 + '%';
        // }

        async function saveData(step) {
            let jsonData;
            if (step == 1) {
                const form = document.getElementById('module1Form');
                const data = new FormData(form);
                jsonData = Object.fromEntries(data.entries());
            }
            else {
                const form = document.getElementById('module2Form');
                const data = new FormData(form);
                jsonData = Object.fromEntries(data.entries());
            }
            // const form = document.getElementById('module1Form');
            // const data = new FormData(form);
            // const jsonData = Object.fromEntries(data.entries());
            const url = step === 1 ? '/submit-module_1' : '/submit-module2';

            try {
                const response = await fetch(`http://127.0.0.1:5000${url}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': 'Bearer ' + (localStorage.getItem('accessToken') || '')
                    },
                    body: JSON.stringify(jsonData),
                });
                const result = await response.text();
                alert(result);
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to save data');
            }
        }

        async function submitData() {
            await saveData(2);
            alert('Form submitted successfully');
        }

        // Console.log the access token
        console.log(localStorage.getItem('accessToken'));

    </script>
</body>

</html>